version: '3.8'
services:
  azurite:
    image: mcr.microsoft.com/azure-storage/azurite:latest
    hostname: azurite
    container_name: azurite
    ports:
      - "10000:10000" # Blob service
      - "10001:10001" # Queue service
      - "10002:10002" # Table service
    command: "azurite --blobHost 0.0.0.0 --queueHost 0.0.0.0 --tableHost 0.0.0.0 --location /data --debug /data/debug.log"
    restart: "always"
  eventstore.db:
    #v23.* is the final version to support our TCP client
    image: eventstore/eventstore:23.10.7-jammy
    hostname: eventstore
    container_name: eventstore
    environment:
      - EVENTSTORE_CLUSTER_SIZE=1
      - EVENTSTORE_RUN_PROJECTIONS=All
      - EVENTSTORE_START_STANDARD_PROJECTIONS=true
      - EVENTSTORE_EXT_IP=0.0.0.0
      - EVENTSTORE_ENABLE_EXTERNAL_TCP=true
      - EVENTSTORE_EXT_TCP_PORT=1113
      - EVENTSTORE_HTTP_PORT=2113
      - EVENTSTORE_INSECURE=true
      - EVENTSTORE_ENABLE_ATOM_PUB_OVER_HTTP=true
    ports:
      - "1113:1113"
      - "2113:2113"
  consul:
    image: hashicorp/consul:latest
    hostname: consul
    container_name: consul
    ports:
      - "8500:8500"
  zookeeper:
    #cp-zookeeper:6.2.0 uses zookeeper 3.5.x
    image: confluentinc/cp-zookeeper:6.2.0
    hostname: zookeeper
    container_name: zookeeper
    ports:
      - "2181:2181"
    environment:
      - ZOO_STANDALONE_ENABLED=true
      - ZOO_CLIENT_PORT=2181
      - ZOOKEEPER_CLIENT_PORT=2181
      - ZOO_AUTOPURGE_SNAPRETAINCOUNT=3
      - ZOO_AUTOPURGE_PURGEINTERVAL=24
    restart: unless-stopped
  kafka-28:
    #cp-kafka:6.2.0 is the final version to support both our KafkaNet client and Kafunk (Apache Kafka 2.8.x)
    image: confluentinc/cp-kafka:6.2.0
    hostname: kafka
    container_name: kafka-28
    depends_on:
      - zookeeper
    environment:
      - KAFKA_BROKER_ID=1
      - KAFKA_CLUSTER_ID=1
      - KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181
      - KAFKA_LISTENERS=PLAINTEXT://:9093
      - KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://localhost:9093
      - KAFKA_NUM_PARTITIONS=1
      - KAFKA_AUTO_CREATE_TOPICS_ENABLE=true
    ports:
      - "9093:9093"
  kafka-39:
    #apache/kafka-3.9.1 is the final version to support our Kafunk client (Apache Kafka 3.9.*)
    image: apache/kafka:3.9.1
    hostname: kafka
    container_name: kafka-39
    ports:
      - "9092:9092"